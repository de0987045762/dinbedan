<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>戰報管理 (Firebase)</title>
  <script type="importmap">
    {
      "imports": {
        "firebase/app": "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"
      }
    }
  </script>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="layout">
    <section id="loginPage" class="card">
      <h1 class="title">戰報管理系統</h1>
      <p class="subtitle">請使用 Firebase 帳號登入</p>
      <form id="loginForm" class="form-grid">
        <label>
          電子郵件
          <input id="loginEmail" type="email" autocomplete="email" required />
        </label>
        <label>
          密碼
          <input id="loginPassword" type="password" autocomplete="current-password" required />
        </label>
        <button type="submit" class="primary">登入</button>
        <button type="button" id="resetPassword" class="link">寄送重設密碼連結</button>
      </form>
      <p class="hint">
        如遇到登入錯誤，請先在 Firebase Console 的 Authentication 服務中啟用 Email/Password 登入方式。
      </p>
    </section>

    <section id="app" class="hidden">
      <header class="card header">
        <div>
          <h2 class="title">戰報管理系統</h2>
          <p id="staffHint" class="subtitle"></p>
        </div>
        <div class="user-info">
          <div><strong>帳號：</strong><span id="userEmail"></span></div>
          <div><strong>角色：</strong><span id="userRole"></span></div>
          <button id="logoutButton" class="danger">登出</button>
        </div>
      </header>

      <section class="card quick-stats" aria-label="儀表板概況">
        <div class="stat">
          <span class="stat-label">戰報筆數</span>
          <span class="stat-value" id="statTotalReports">0</span>
        </div>
        <div class="stat">
          <span class="stat-label">本月營收總額</span>
          <span class="stat-value" id="statMonthlySales">0</span>
        </div>
        <div class="stat">
          <span class="stat-label">菜單品項紀錄</span>
          <span class="stat-value" id="statMenuEntries">0</span>
        </div>
        <div class="stat">
          <span class="stat-label">登入人數</span>
          <span class="stat-value" id="statStaffCount">0</span>
        </div>
      </section>

      <p id="statusMessage" class="status" aria-live="polite"></p>

      <section class="card" id="staffManagementCard" data-admin-only>
        <h3>人員管理</h3>
        <p class="hint">僅需輸入 Firebase Authentication 的 UID 與電子郵件，即可設定角色與可見功能。</p>
        <form id="staffForm" class="form-grid">
          <div class="form-grid two-column">
            <label>
              使用者 UID
              <input id="staffUid" type="text" placeholder="Auth UID" required />
            </label>
            <label>
              電子郵件
              <input id="staffEmail" type="email" placeholder="example@mail.com" required />
            </label>
            <label>
              顯示名稱
              <input id="staffName" type="text" placeholder="顯示在系統中的名稱" />
            </label>
            <label>
              角色
              <select id="staffRole" required>
                <option value="staff">員工</option>
                <option value="manager">主管</option>
                <option value="admin">管理員</option>
              </select>
            </label>
          </div>
          <fieldset class="feature-grid">
            <legend>功能權限</legend>
            <label><input type="checkbox" value="reports" name="staffFeature" />戰報</label>
            <label><input type="checkbox" value="menu" name="staffFeature" />菜單管理</label>
            <label><input type="checkbox" value="schedule" name="staffFeature" />排班</label>
            <label><input type="checkbox" value="wishes" name="staffFeature" />許願池</label>
            <label><input type="checkbox" value="store" name="staffFeature" />點數商城</label>
          </fieldset>
          <div class="form-inline">
            <button type="submit" class="primary">儲存人員資料</button>
            <button type="button" id="staffFormReset" class="link">清除欄位</button>
            <button type="button" id="staffDeleteButton" class="danger hidden">刪除此人員資料</button>
          </div>
        </form>
        <table class="table">
          <thead>
            <tr>
              <th>姓名</th>
              <th>電子郵件</th>
              <th>角色</th>
              <th>功能權限</th>
              <th class="actions">操作</th>
            </tr>
          </thead>
          <tbody id="staffTableBody"></tbody>
        </table>
      </section>

      <section class="card">
        <h3>公告</h3>
        <form id="announcementForm" class="form-grid" data-admin-only>
          <label>
            標題
            <input name="title" type="text" required />
          </label>
          <label>
            內容
            <textarea name="content" rows="3" required></textarea>
          </label>
          <button type="submit" class="primary">新增公告</button>
        </form>
        <ul id="announcementList" class="list"></ul>
      </section>

      <section class="card">
        <h3>據點</h3>
        <form id="locationForm" class="form-inline" data-admin-only>
          <input id="locationName" type="text" placeholder="輸入據點名稱" required />
          <button type="submit" class="primary">新增</button>
        </form>
        <ul id="locationList" class="list"></ul>
      </section>

      <section class="card" data-feature="reports">
        <h3>戰報</h3>
        <form id="reportForm" class="form-grid">
          <label>
            日期
            <input id="reportDate" type="date" required />
          </label>
          <label>
            據點
            <input id="reportLocation" type="text" list="locationOptions" placeholder="輸入或選擇據點" required />
          </label>
          <label>
            今日營收 (元)
            <input id="reportSales" type="number" min="0" step="1" value="0" required />
          </label>
          <label class="full">
            備註
            <textarea id="reportNotes" rows="3" placeholder="可輸入重點或描述"></textarea>
          </label>
          <button type="submit" class="primary">新增戰報</button>
        </form>
        <datalist id="locationOptions"></datalist>
        <table class="table">
          <thead>
            <tr>
              <th>日期</th>
              <th>據點</th>
              <th>營收</th>
              <th>建立者</th>
              <th>備註</th>
              <th class="actions">操作</th>
            </tr>
          </thead>
          <tbody id="reportTableBody"></tbody>
        </table>
      </section>

      <section class="card" data-feature="menu">
        <h3>菜單管理</h3>
        <form id="menuForm" class="form-grid">
          <label>
            日期
            <input id="menuDate" type="date" required />
          </label>
          <label>
            據點
            <input id="menuLocation" type="text" list="locationOptions" placeholder="輸入或選擇據點" required />
          </label>
          <label>
            品項名稱
            <input id="menuItem" type="text" placeholder="例如：雞排飯" required />
          </label>
          <label>
            數量
            <input id="menuQuantity" type="number" min="0" step="1" value="0" required />
          </label>
          <label class="full">
            備註
            <textarea id="menuNotes" rows="2" placeholder="可記錄每日菜單狀況"></textarea>
          </label>
          <button type="submit" class="primary">新增菜單紀錄</button>
        </form>
        <table class="table">
          <thead>
            <tr>
              <th>日期</th>
              <th>據點</th>
              <th>品項</th>
              <th>數量</th>
              <th>備註</th>
              <th class="actions">操作</th>
            </tr>
          </thead>
          <tbody id="menuTableBody"></tbody>
        </table>
      </section>

      <section class="card" data-feature="schedule">
        <h3>排班</h3>
        <form id="scheduleForm" class="form-grid">
          <label>
            日期
            <input id="scheduleDate" type="date" required />
          </label>
          <label>
            人員名稱
            <input id="scheduleStaff" type="text" list="staffOptions" placeholder="輸入員工姓名" required />
          </label>
          <label>
            班別
            <select id="scheduleShift" required>
              <option value="早班">早班</option>
              <option value="中班">中班</option>
              <option value="晚班">晚班</option>
              <option value="全日">全日</option>
            </select>
          </label>
          <label class="full">
            備註
            <textarea id="scheduleNotes" rows="2" placeholder="可填寫工作重點"></textarea>
          </label>
          <button type="submit" class="primary">新增班表</button>
        </form>
        <datalist id="staffOptions"></datalist>
        <table class="table">
          <thead>
            <tr>
              <th>日期</th>
              <th>人員</th>
              <th>班別</th>
              <th>備註</th>
              <th class="actions">操作</th>
            </tr>
          </thead>
          <tbody id="scheduleTableBody"></tbody>
        </table>
      </section>

      <section class="card" data-feature="wishes">
        <h3>許願池</h3>
        <form id="wishForm" class="form-grid">
          <label>
            願望標題
            <input id="wishTitle" type="text" placeholder="輸入願望主題" required />
          </label>
          <label class="full">
            內容
            <textarea id="wishDescription" rows="3" placeholder="描述願望內容" required></textarea>
          </label>
          <button type="submit" class="primary">送出願望</button>
        </form>
        <ul id="wishList" class="list"></ul>
      </section>

      <section class="card" data-feature="store">
        <h3>點數商城</h3>
        <form id="storeForm" class="form-grid">
          <label>
            兌換品項
            <input id="storeItem" type="text" placeholder="想兌換的商品" required />
          </label>
          <label>
            數量
            <input id="storeQuantity" type="number" min="1" step="1" value="1" required />
          </label>
          <label class="full">
            備註
            <textarea id="storeNotes" rows="2" placeholder="可填寫點數或其他需求"></textarea>
          </label>
          <button type="submit" class="primary">提出兌換申請</button>
        </form>
        <table class="table">
          <thead>
            <tr>
              <th>品項</th>
              <th>數量</th>
              <th>申請人</th>
              <th>備註</th>
              <th class="actions">操作</th>
            </tr>
          </thead>
          <tbody id="storeTableBody"></tbody>
        </table>
      </section>
    </section>
  </main>

  <script type="module" src="app.js"></script>
</body>
</html>
